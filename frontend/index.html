<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      cont
      <!--
      ULTRA
      AGGRESSIVE
      Service
      Worker
      Blocking
      --
    />
    <script>
      // Block service worker registration at the API level
      if ("serviceWorker" in navigator) {
        // Override the register function to prevent ANY service worker registration
        const originalRegister = navigator.serviceWorker.register;
        navigator.serviceWorker.register = function () {
          console.log("ğŸš« BLOCKED service worker registration attempt");
          return Promise.reject(
            new Error("Service workers disabled for development")
          );
        };

        // Clear any existing registrations IMMEDIATELY
        navigator.serviceWorker.getRegistrations().then((registrations) => {
          registrations.forEach((registration) => {
            registration.unregister().then(() => {
              console.log("ğŸ—‘ï¸ Force unregistered SW:", registration.scope);
            });
          });
        });
      }

      console.log("ğŸš«ğŸ’¥ ULTRA NUCLEAR CACHE BUSTING MODE");
      console.log("ğŸ†” Session ID:", window.CACHE_BUSTER);
    </script>
    "width=device-width, initial-scale=1.0" />
    <!-- Force no caching during development -->
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      name="description"
      content="Fun Addition Game - A fun math game for elementary kids to practice addition!"
    />
    <title>ğŸ® Addition Game for Kids</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2196F3" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Addition Game" />

    <!-- Manifest DISABLED for development (prevents SW registration) -->
    <!-- <link rel="manifest" href="manifest.json" /> -->

    <!-- Icons -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="icons/icon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="icons/icon-16x16.png"
    />
    <link rel="apple-touch-icon" href="icons/icon-192x192.png" />

    <!-- AGGRESSIVE Cache Busting for Development -->
    <script>
      // Generate a unique timestamp for this page load
      window.CACHE_BUSTER =
        Date.now() + Math.random().toString(36).substr(2, 9);

      // Immediately add CSS with aggressive cache busting
      const cssLink = document.createElement("link");
      cssLink.rel = "stylesheet";
      cssLink.href = "css/main.css?bust=" + window.CACHE_BUSTER;
      // Add additional cache-busting headers via CSS loading
      cssLink.setAttribute("data-timestamp", window.CACHE_BUSTER);
      document.head.appendChild(cssLink);

      console.log("ğŸš« Cache buster ID:", window.CACHE_BUSTER);
    </script>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>ğŸ® Addition Game!</h1>
      </header>

      <main>
        <div id="calculator">
          <!-- Game will load here -->
          <div class="loading">ğŸ¯ Loading your math adventure...</div>
        </div>
      </main>

      <footer>
        <p>ğŸŒŸ Keep practicing and have fun! ğŸŒŸ</p>
      </footer>
    </div>

    <!-- AGGRESSIVE Script Loading with Multiple Cache Busting -->
    <script>
      // Use the same cache buster for all scripts but add randomization
      const scripts = ["js/simple-storage.js", "js/api.js", "js/main.js"];

      scripts.forEach((src, index) => {
        const script = document.createElement("script");
        // Multiple cache-busting parameters
        script.src =
          src +
          "?bust=" +
          window.CACHE_BUSTER +
          "&t=" +
          Date.now() +
          "&r=" +
          Math.random() +
          "&i=" +
          index;

        // Disable caching on the script element itself
        script.setAttribute("data-no-cache", "true");
        script.crossOrigin = "anonymous";

        document.head.appendChild(script);
        console.log("ğŸ“„ Loading script:", script.src);
      });
    </script>

    <!-- NUCLEAR Option: Force Fresh Everything -->
    <script>
      console.log("ï¿½ NUCLEAR CACHE BUSTING MODE");
      console.log("ğŸ†” Session ID:", window.CACHE_BUSTER);

      // 1. Clear ALL possible caches AGAIN
      if ("caches" in window) {
        caches.keys().then((names) => {
          names.forEach((name) => {
            caches.delete(name);
            console.log("ğŸ—‘ï¸ Deleted cache:", name);
          });
        });
      }

      // 2. Clear localStorage AND sessionStorage completely
      try {
        localStorage.clear();
        sessionStorage.clear();
        console.log("ğŸ—‘ï¸ Cleared ALL storage");
      } catch (e) {
        console.log("âš ï¸ Could not clear storage:", e);
      }

      // 3. Force hard reload if this is the first run
      const hasReloaded = sessionStorage.getItem("hasHardReloaded");
      if (!hasReloaded) {
        sessionStorage.setItem("hasHardReloaded", "true");
        console.log("ğŸ”„ Forcing hard reload to clear everything...");
        setTimeout(() => {
          window.location.reload(true);
        }, 500);
      } else {
        console.log("âœ… ULTRA cache busting complete - ready for development!");
        console.log("ğŸ® Game should now load with fresh files every time!");
      }
    </script>
  </body>
</html>
